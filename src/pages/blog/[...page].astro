---
import '../../styles/main.scss';
import '../../styles/_blog.scss';
import Footer from "../../components/Footer.astro";
import Nav from "../../components/Nav.astro";
import { CaretDoubleLeft, CaretDoubleRight } from "phosphor-react";

export async function getStaticPaths({ paginate, rss }) {
  const allPosts = Astro.fetchContent("./*.md").sort(
    (a, b) =>
      new Date(b.publishDate).valueOf() - new Date(a.publishDate).valueOf()
  );

  // Generate an RSS feed from this collection
  rss({
    title: `Vipin Mishra's Blog`,
    stylesheet: true,
    description: "A blog with articles around CSS & Web Design",
    customData: `<language>en-us</language>`,
    items: allPosts.map((item) => ({
      title: item.title,
      description: item.description,
      link: item.url,
      pubDate: item.publishDate,
    })),
  });

  return paginate(allPosts, { pageSize: 5 });
}

const { page } = Astro.props;

// Vars
let title = "Blog | Vipin Mishra";
let metaDescription =
  "I design & develop modern websites with pixel-perfection in mind, love solving complex design problems & have a strong devotion towards CSS";
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="description" content={metaDescription} />
    <title>{title}</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#1270e3" />
  </head>


  <body class="blog-list d-flex flex-column">
    <Nav />

    <main class="blog-posts-list">
      <div class="blog-posts-header text-center">
        <h2 class="headline">Blog</h2>
        <p>
          I try to share my learnings through blog posts and cover topics around
          web-design & development!
        </p>
      </div>
      <!-- Blog list  -->

      <div class="posts-list container py-5 py-lg-7">
        {page.data.map((post) => (
          <div class="post-outer">
            <span class="date">{post.publishDate}</span>
            <h2 class="post-title">
              <a href={post.url}>{post.title}</a>
            </h2>
            <p class="post-description">{post.description}</p>
          </div>
        ))}
      </div>
      <div class="page-meta py-4 mb-5">
        <div
          class="page-meta-inner container d-flex flex-column align-items-center"
        >
          <p class="pages">
            Showing {page.currentPage} of total <b>{page.lastPage}</b> pages.
          </p>

          {(page.url.prev || page.url.next) && (
            <div class="posts-nav mt-4">
              <a
                href={page.url.prev}
                class={`prev ${page.url.prev ? "" : "isDisabled"}`}
              >
                <CaretDoubleLeft size={20} /> Prev
              </a>

              <a
                href={page.url.next}
                class={`next ${page.url.next ? "" : "isDisabled"}`}
              >
                Next <CaretDoubleRight size={20} />
              </a>
            </div>
          )}
        </div>
      </div>
    </main>
    <Footer />
  </body>
</html>
